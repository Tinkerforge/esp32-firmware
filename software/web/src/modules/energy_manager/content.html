<div class="tab-pane fade" role="tabpanel" aria-labelledby="sidebar-energy-manager" id="energy-manager">
    <div id="energy_manager_header" class="sticky-under-top"></div>

    <form id="energy_manager_config_form" class="needs-validation" novalidate>
        <!--
            Use custom validation instead of the browser default, that is broken on Chrome
            See: https://getbootstrap.com/docs/4.5/components/forms/#validation
        -->

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="energy_manager_config_excess_charging_enable" class="col-form-label form-label" data-i18n="energy_manager.content.excess_charging"></label>
            </div>
            <div class="col-lg-9 col-xl-6">
                <div class="borderless-form-control custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="energy_manager_config_excess_charging_enable">
                    <label class="custom-control-label" for="energy_manager_config_excess_charging_enable" data-i18n="energy_manager.content.excess_charging_desc"></label>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="energy_manager_config_contactor_installed" class="col-form-label form-label" data-i18n="energy_manager.content.contactor_installed"></label>
            </div>
            <div class="col-lg-9 col-xl-6">
                <div class="borderless-form-control custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="energy_manager_config_contactor_installed">
                    <label class="custom-control-label" for="energy_manager_config_contactor_installed" data-i18n="energy_manager.content.contactor_installed_desc"></label>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <label for="energy_manager_config_phase_switching_mode" class="col-lg-3 col-xl-2 col-form-label form-label" data-i18n="energy_manager.content.phase_switching_config"></label>

            <div class="col-lg-9 col-xl-6">
                <select id="energy_manager_config_phase_switching_mode" class="custom-select">
                </select>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="energy_manager_config_maximum_power_from_grid" class="col-form-label">
                    <span class="form-label pr-2" data-i18n="energy_manager.content.maximum_power_from_grid"></span>
                    <span class="text-muted" data-i18n="energy_manager.content.maximum_power_from_grid_muted"></span>
                </label>
            </div>
            <div class="col-lg-9 col-xl-6 input-group">
                <input id="energy_manager_config_maximum_power_from_grid" class="form-control" type="number" min="0" step="any" required>
                <div class="input-group-append">
                    <div class="input-group-text form-control">kW</div>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="energy_manager_config_maximum_available_current" class="col-form-label">
                    <span class="form-label pr-2" data-i18n="energy_manager.content.maximum_available_current"></span>
                    <span class="text-muted" data-i18n="energy_manager.content.maximum_available_current_muted"></span>
                </label>
            </div>
            <div class="col-lg-9 col-xl-6 input-group">
                <input id="energy_manager_config_maximum_available_current" class="form-control" type="number" min="0" step="any" required>
                <div class="input-group-append">
                    <div class="input-group-text form-control">A</div>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="energy_manager_config_minimum_current" class="col-form-label">
                    <span class="form-label pr-2" data-i18n="energy_manager.content.minimum_current"></span>
                    <span class="text-muted" data-i18n="energy_manager.content.minimum_current_muted"></span>
                </label>
            </div>
            <div class="col-lg-9 col-xl-6 input-group">
                <input id="energy_manager_config_minimum_current" class="form-control" type="number" min="6" max="32" step="any" required>
                <div class="input-group-append">
                    <div class="input-group-text form-control">A</div>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="energy_manager_config_hysteresis_time" class="col-form-label">
                    <span class="form-label pr-2" data-i18n="energy_manager.content.hysteresis_time"></span>
                    <span class="text-muted" data-i18n="energy_manager.content.hysteresis_time_muted"></span>
                </label>
            </div>
            <div class="col-lg-9 col-xl-6 input-group">
                <input id="energy_manager_config_hysteresis_time" class="form-control" type="number" min="0" max="60" step="1" required>
                <div class="input-group-append">
                    <div class="input-group-text form-control"><span data-i18n="energy_manager.content.hysteresis_time_unit"></span></div>
                </div>
            </div>
        </div>

        <!-- When moving to PreAct: Show this setting only when the user chooses a hysteresis time below 10. Maybe add a big fat warning in red or something. -->
        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="energy_manager_config_hysteresis_wear_accepted" class="col-form-label form-label" data-i18n="energy_manager.content.hysteresis_wear_agreement"></label>
            </div>
            <div class="col-lg-9 col-xl-6">
                <div class="borderless-form-control custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="energy_manager_config_hysteresis_wear_accepted">
                    <label class="custom-control-label" for="energy_manager_config_hysteresis_wear_accepted" data-i18n="energy_manager.content.hysteresis_wear_desc"></label>
                </div>
            </div>
        </div>

        <div class="row mb-3 pt-3">
            <div class="col-xl-8 d-flex justify-content-between border-bottom">
                <span class="h3" data-i18n="energy_manager.content.relay"></span>
            </div>
        </div>

        <div class="form-group row">
            <label for="energy_manager_config_relay_config" class="col-lg-3 col-xl-2 col-form-label form-label" data-i18n="energy_manager.content.relay_config"></label>

            <div class="col-lg-9 col-xl-6">
                <select id="energy_manager_config_relay_config" class="custom-select">
                    <option value="0" selected data-i18n="energy_manager.content.relay_unused"></option>
                    <option value="1" data-i18n="energy_manager.content.relay_rules"></option>
                    <option value="2" data-i18n="energy_manager.content.extern"></option>
                </select>
            </div>
        </div>
        <div id="energy_manager_config_relay_rules" class="collapse">
            <div class="form-group row">
                <div class="col-lg-3 col-xl-2"></div>
                <label for="energy_manager_config_relay_config_when" class="col-lg-1 col-xl-1 col-form-label form-label" data-i18n="energy_manager.content.relay_when"></label>

                <div class="col-lg-8 col-xl-5">
                    <select id="energy_manager_config_relay_config_when" class="custom-select">
                        <option value="0" selected data-i18n="energy_manager.content.input3"></option>
                        <option value="1" data-i18n="energy_manager.content.input4"></option>
                        <option value="2" data-i18n="energy_manager.content.phase_switching"></option>
                        <option value="3" data-i18n="energy_manager.content.contactor_check"></option>
                        <option value="4" data-i18n="energy_manager.content.power_available"></option>
                        <option value="5" data-i18n="energy_manager.content.grid_draw"></option>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-lg-3 col-xl-2"></div>
                <label for="energy_manager_config_relay_config_is" class="col-lg-1 col-xl-1 col-form-label form-label" data-i18n="energy_manager.content.is"></label>

                <div class="col-lg-8 col-xl-5">
                    <select id="energy_manager_config_relay_config_is" class="custom-select">
                    </select>
                </div>
            </div>
        </div>

        <div class="row mb-3 pt-3">
            <div class="col-xl-8 d-flex justify-content-between border-bottom">
                <span class="h3" data-i18n="energy_manager.content.inputs"></span>
            </div>
        </div>

        <!-- When excess charging is chosen for input 3 or 4, disable excess charging option at the top of the page.
            Show warning if both inputs are set to excess charging because that is not supported.
            When both inputs are set to current limit, show info that the lowest active limit will be applied.
            When both inputs are set to grid draw override, show info that input 4 value will be used when both inputs are active. -->
        <div class="form-group row">
            <label for="energy_manager_config_input3_config" class="col-lg-3 col-xl-2 col-form-label form-label" data-i18n="energy_manager.content.input3_config"></label>

            <div class="col-lg-9 col-xl-6">
                <select id="energy_manager_config_input3_config" class="custom-select">
                </select>
            </div>
        </div>
        <div id="energy_manager_config_input3_rules" class="collapse">
            <div id="energy_manager_config_input3_rules_limit" class="form-group row">
                <!-- For PreAct: The class stuff below is just copy&paste and might be wrong. -->
                <div class="col-lg-3 col-xl-2"></div>
                <label id="energy_manager_config_input3_rules_limit_label" for="energy_manager_config_input3_config_limit" class="col-lg-1 col-xl-1 col-form-label form-label">?</label>

                <div class="col-lg-8 col-xl-5 input-group">
                    <input id="energy_manager_config_input3_config_limit" class="form-control" type="number" step="any">
                    <div class="input-group-append">
                        <div id="energy_manager_config_input3_rules_limit_unit" class="input-group-text form-control">?</div>
                    </div>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-lg-3 col-xl-2"></div>
                <label for="energy_manager_config_input3_config_when" class="col-lg-1 col-xl-1 col-form-label form-label" data-i18n="energy_manager.content.input_when"></label>

                <div class="col-lg-8 col-xl-5">
                    <select id="energy_manager_config_input3_config_when" class="custom-select">
                        <option value="0" selected data-i18n="energy_manager.content.input_high"></option>
                        <option value="1" data-i18n="energy_manager.content.input_low"></option>
                    </select>
                </div>
            </div>
        </div>


        <div class="form-group row">
            <label for="energy_manager_config_input4_config" class="col-lg-3 col-xl-2 col-form-label form-label" data-i18n="energy_manager.content.input4_config"></label>

            <div class="col-lg-9 col-xl-6">
                <select id="energy_manager_config_input4_config" class="custom-select">
                    <option value="0" selected data-i18n="energy_manager.content.input_unused"></option>
                    <option value="2" data-i18n="energy_manager.content.block_charging"></option>
                    <option value="3" data-i18n="energy_manager.content.switch_excess_charging"></option>
                    <option value="4" data-i18n="energy_manager.content.limit_max_current"></option>
                    <option value="5" data-i18n="energy_manager.content.override_grid_draw"></option>
                </select>
            </div>
        </div>
        <div id="energy_manager_config_input4_rules" class="collapse">
            <div id="energy_manager_config_input4_rules_limit" class="form-group row">
                <!-- For PreAct: The class stuff below is just copy&paste and might be wrong. -->
                <div class="col-lg-3 col-xl-2"></div>
                <label id="energy_manager_config_input4_rules_limit_label" for="energy_manager_config_input4_config_limit" class="col-lg-1 col-xl-1 col-form-label form-label">?</label>

                <div class="col-lg-8 col-xl-5 input-group">
                    <input id="energy_manager_config_input4_config_limit" class="form-control" type="number" step="any">
                    <div class="input-group-append">
                        <div id="energy_manager_config_input4_rules_limit_unit" class="input-group-text form-control">?</div>
                    </div>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-lg-3 col-xl-2"></div>
                <label for="energy_manager_config_input4_config_when" class="col-lg-1 col-xl-1 col-form-label form-label" data-i18n="energy_manager.content.input_when"></label>

                <div class="col-lg-8 col-xl-5">
                    <select id="energy_manager_config_input4_config_when" class="custom-select">
                        <option value="0" selected data-i18n="energy_manager.content.input_high"></option>
                        <option value="1" data-i18n="energy_manager.content.input_low"></option>
                    </select>
                </div>
            </div>
        </div>
    </form>

    <div class="row mb-3 pt-3">
        <div class="col-xl-8 d-flex justify-content-between border-bottom">
            <span class="h3" data-i18n="energy_manager.content.debug"></span>
        </div>
    </div>

    <div class="form-group row">
        <div class="col-lg-3 col-xl-2">
            <label class="col-form-label">
                <span class="form-label pr-2" data-i18n="energy_manager.content.debug_description"></span>
                <span class="text-muted" data-i18n="energy_manager.content.debug_description_muted"></span>
            </label>
        </div>
        <div class="col-lg-9 col-xl-6">
            <div class="input-group pb-2">
                <button id="debug_start" class="btn btn-primary form-control rounded-right mr-2" type="button" data-i18n="energy_manager.content.debug_start"></button>
                <button id="debug_stop" class="btn btn-primary form-control rounded-left" type="button" data-i18n="energy_manager.content.debug_stop"></button>
            </div>
            <input id="debug_label" class="form-control" type="text" placeholder="..." readonly>
        </div>
    </div>

    <div class="row mb-3 pt-3">
        <div class="col-xl-8 d-flex justify-content-between border-bottom">
            <span class="h3" data-i18n="energy_manager.content.low_level_state"></span>
            <button class="btn btn-primary mb-2" type="button" data-toggle="collapse" data-target="#low_level_state_collapse" aria-expanded="false" aria-controls="low_level_state_collapse" data-i18n="energy_manager.content.low_level_state_show"></button>
        </div>
    </div>
    <div class="collapse" id="low_level_state_collapse">
        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="state_contactor" class="col-form-label form-label" data-i18n="energy_manager.content.state_contactor"></label>
            </div>
            <div class="col-lg-9 col-xl-6">
                <input id="state_contactor" class="form-control" type="text" placeholder="..." readonly>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="state_led_r" class="col-form-label">
                    <span class="form-label pr-2" data-i18n="energy_manager.content.state_led"></span>
                    <span class="text-muted" data-i18n="energy_manager.content.state_led_names"></span>
                </label>
            </div>
            <div class="col-lg-9 col-xl-6 row pr-0">
                <div class="col-lg-3 col-xl-2">
                    <input id="state_led_r" class="form-control" type="text" placeholder="..." readonly>
                </div>
                <div class="col-lg-3 col-xl-2">
                    <input id="state_led_g" class="form-control" type="text" placeholder="..." readonly>
                </div>
                <div class="col-lg-3 col-xl-2">
                    <input id="state_led_b" class="form-control" type="text" placeholder="..." readonly>
                </div>
            </div>
        </div>

        <div class="form-group row pb-3">
            <div class="col-lg-3 col-xl-2">
                <label for="btn_groups_gpios" class="col-form-label">
                    <span class="form-label pr-2" data-i18n="energy_manager.content.gpios"></span>
                    <span class="text-muted" data-i18n="energy_manager.content.gpio_names_0"></span>
                </label>
            </div>
            <div id="btn_groups_gpios" class="col-lg-8">
                <div id="btn_group_gpio0" class="btn-group-vertical flex-wrap mb-1" role="group">
                    <button type="button" class="btn btn-outline-primary" disabled data-i18n="energy_manager.content.gpio_high"></button>
                    <button type="button" class="btn btn-outline-secondary" disabled data-i18n="energy_manager.content.gpio_low"></button>
                </div>
                <div id="btn_group_gpio1" class="btn-group-vertical flex-wrap mb-1" role="group">
                    <button type="button" class="btn btn-outline-primary" disabled data-i18n="energy_manager.content.gpio_high"></button>
                    <button type="button" class="btn btn-outline-secondary" disabled data-i18n="energy_manager.content.gpio_low"></button>
                </div>
                <div id="btn_group_gpio2" class="btn-group-vertical flex-wrap mb-1" role="group">
                    <button type="button" class="btn btn-outline-primary" disabled data-i18n="energy_manager.content.gpio_high"></button>
                    <button type="button" class="btn btn-outline-secondary" disabled data-i18n="energy_manager.content.gpio_low"></button>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="state_input_voltage" class="col-form-label">
                    <span class="form-label" data-i18n="energy_manager.content.state_input_voltage"></span>
                </label>
            </div>
            <div class="col-lg-9 col-xl-6">
                <input id="state_input_voltage" class="form-control" type="text" placeholder="..." readonly>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3 col-xl-2">
                <label for="state_contactor_check" class="col-form-label">
                    <span class="form-label" data-i18n="energy_manager.content.state_contactor_check"></span>
                </label>
            </div>
            <div class="col-lg-9 col-xl-6">
                <input id="state_contactor_check" class="form-control" type="text" placeholder="..." readonly>
            </div>
        </div>
    </div>
</div>
